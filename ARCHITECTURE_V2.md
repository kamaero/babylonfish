# BabylonFish 2.0 - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–ª–∞–Ω

## üéØ –¶–µ–ª–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

1. **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–æ–Ω–æ–ª–∏—Ç–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤ –Ω–∞ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
2. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å unit-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
3. **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ–∏—á –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞
4. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - —É–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
5. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ–π

## üèó –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–æ–≤

### Core Engine
```
BabylonFishCore/
‚îú‚îÄ‚îÄ EventTapManager.swift      // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ event tap –∏ permissions
‚îú‚îÄ‚îÄ EventProcessor.swift       // –û–±—Ä–∞–±–æ—Ç–∫–∞ CGEvent (–∑–∞–º–µ–Ω—è–µ—Ç handleKeyDown)
‚îú‚îÄ‚îÄ BufferManager.swift        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ keyBuffer –∏ –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ —Å–ª–æ–≤
‚îú‚îÄ‚îÄ LayoutSwitcher.swift       // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞—Å–∫–ª–∞–¥–æ–∫ –∏ –ø–µ—Ä–µ–ø–µ—á–∞—Ç–∫–∞
‚îî‚îÄ‚îÄ ContextAnalyzer.swift      // –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (—Ç–∏–ø –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, secure fields)
```

### Language Intelligence
```
Language/
‚îú‚îÄ‚îÄ LanguageDetector.swift     // –î–µ—Ç–µ–∫—Ü–∏—è —è–∑—ã–∫–∞ (–≤—ã–¥–µ–ª–µ–Ω–æ –∏–∑ LanguageManager)
‚îú‚îÄ‚îÄ SuggestionEngine.swift     // Trie-–±–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ SpellCheckService.swift    // –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å NSSpellChecker
‚îî‚îÄ‚îÄ LearningManager.swift      // –£—á–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ä–µ—à–µ–Ω–∏–π
```

### Configuration & State
```
Configuration/
‚îú‚îÄ‚îÄ AppConfig.swift           // Codable –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ UserPreferences.swift     // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îú‚îÄ‚îÄ AppState.swift           // –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ MigrationService.swift    // –ú–∏–≥—Ä–∞—Ü–∏—è –∏–∑ UserDefaults
```

### UI Components
```
UI/
‚îú‚îÄ‚îÄ StatusBarController.swift // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å-–±–∞—Ä–æ–º
‚îú‚îÄ‚îÄ SettingsWindow.swift      // –û–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (SwiftUI)
‚îú‚îÄ‚îÄ SuggestionWindow.swift    // –û–∫–Ω–æ –ø–æ–¥—Å–∫–∞–∑–æ–∫ (–æ—Å—Ç–∞–µ—Ç—Å—è)
‚îî‚îÄ‚îÄ StatisticsDashboard.swift // –ü–∞–Ω–µ–ª—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```

### Utilities
```
Utils/
‚îú‚îÄ‚îÄ KeyMapper.swift          // (–æ—Å—Ç–∞–µ—Ç—Å—è —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏)
‚îú‚îÄ‚îÄ Logger.swift            // (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏)
‚îú‚îÄ‚îÄ HotkeyManager.swift     // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ä—è—á–∏–º–∏ –∫–ª–∞–≤–∏—à–∞–º–∏
‚îî‚îÄ‚îÄ PerformanceMonitor.swift // –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```

## üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
CGEvent ‚Üí EventTapManager ‚Üí EventProcessor ‚Üí BufferManager
                                              ‚Üì
                                    ContextAnalyzer (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)
                                              ‚Üì
                                    LanguageDetector (–¥–µ—Ç–µ–∫—Ü–∏—è —è–∑—ã–∫–∞)
                                              ‚Üì
                                    SuggestionEngine (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π)
                                              ‚Üì
                                    LayoutSwitcher (–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ + –ø–µ—Ä–µ–ø–µ—á–∞—Ç–∫–∞)
```

## üì¶ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (Codable)

```swift
struct AppConfig: Codable {
    var version: Int
    var languageProfiles: [LanguageProfile]
    var hotkeys: HotkeyConfig
    var exceptions: ExceptionRules
    var performance: PerformanceSettings
}

struct ExceptionRules: Codable {
    var appExceptions: [AppException] // bundleId, processName
    var wordExceptions: Set<String>
    var contextRules: [ContextRule]   // —Ç–µ—Ä–º–∏–Ω–∞–ª, IDE, –∏–≥—Ä—ã
}

struct HotkeyConfig: Codable {
    var doubleShiftEnabled: Bool
    var forceSwitchKey: KeyCombo?
    var quickFixPanelKey: KeyCombo?
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```
Tests/
‚îú‚îÄ‚îÄ UnitTests/
‚îÇ   ‚îú‚îÄ‚îÄ LanguageDetectorTests.swift
‚îÇ   ‚îú‚îÄ‚îÄ BufferManagerTests.swift
‚îÇ   ‚îî‚îÄ‚îÄ ConfigurationTests.swift
‚îú‚îÄ‚îÄ IntegrationTests/
‚îÇ   ‚îî‚îÄ‚îÄ EventProcessingTests.swift
‚îî‚îÄ‚îÄ UITests/
    ‚îî‚îÄ‚îÄ SettingsUITests.swift
```

## üöÄ –ü–æ—ç—Ç–∞–ø–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –§—É–Ω–¥–∞–º–µ–Ω—Ç
1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫ –≤ Sources/
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å AppConfig —Å –º–∏–≥—Ä–∞—Ü–∏–µ–π –∏–∑ UserDefaults
3. –†–∞–∑–¥–µ–ª–∏—Ç—å InputListener –Ω–∞ EventProcessor + BufferManager

### –≠—Ç–∞–ø 2: –Ø–¥—Ä–æ
1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å ContextAnalyzer –¥–ª—è —É–º–Ω–æ–≥–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
2. –°–æ–∑–¥–∞—Ç—å Trie-based SuggestionEngine
3. –î–æ–±–∞–≤–∏—Ç—å HotkeyManager –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π

### –≠—Ç–∞–ø 3: UI –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
1. –û–±–Ω–æ–≤–∏—Ç—å SettingsWindow –¥–ª—è –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
2. –î–æ–±–∞–≤–∏—Ç—å StatisticsDashboard
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å PerformanceMonitor

### –≠—Ç–∞–ø 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
1. –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
2. –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
3. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## üìÅ –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
Sources/
‚îú‚îÄ‚îÄ BabylonFish/
‚îÇ   ‚îú‚îÄ‚îÄ Core/
‚îÇ   ‚îú‚îÄ‚îÄ Language/
‚îÇ   ‚îú‚îÄ‚îÄ Configuration/
‚îÇ   ‚îú‚îÄ‚îÄ UI/
‚îÇ   ‚îî‚îÄ‚îÄ Utils/
‚îú‚îÄ‚îÄ BabylonFishCore/ (library –¥–ª—è shared code)
‚îî‚îÄ‚îÄ BabylonFishTests/
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ú–∏–≥—Ä–∞—Ü–∏—è —Å v1
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è UserDefaults ‚Üí AppConfig
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ learned words –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á–∞—Å—Ç—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –º–∞—Å—Å–∏–≤–∞–º–∏
- –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–ª–æ–≤–∞—Ä–µ–π
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—è–∂–µ–ª—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (spell checking)

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- Thread-safe –¥–æ—Å—Ç—É–ø –∫ shared state
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ memory management (Unmanaged)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

---

*–≠—Ç–æ –∂–∏–≤–æ–π –¥–æ–∫—É–º–µ–Ω—Ç. –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ –º–µ—Ä–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.*